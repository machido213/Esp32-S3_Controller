# ğŸ® ESP32-S3 Industrial Remote Controller

é€™æ˜¯ä¸€å€‹åŸºæ–¼ **ESP32-S3 (N16R8)** çš„å·¥æ§é™æ§å™¨ç³»çµ±ï¼Œä½œç‚º ROS æ©Ÿå™¨äºº (Jetson Orin Nano) çš„é ç«¯æ§åˆ¶ä»‹é¢ã€‚æœ¬ç³»çµ±è² è²¬è®€å–é›»æ§ç®±è¡¨é¢çš„é–‹é—œã€é›»ä½å™¨èˆ‡æ–æ¡¿è¨Šè™Ÿï¼Œé€é UART èˆ‡ Jetson é€šè¨Šï¼Œä¸¦å…·å‚™ **Web ç›£æ§å„€è¡¨æ¿**ã€**NVS åƒæ•¸è¨˜æ†¶** èˆ‡ **WiFi æ–·ç·šæ•‘æ´æ¨¡å¼**ã€‚

## âœ¨ å°ˆæ¡ˆç‰¹é» (Features)

*   **å¤šæ¨¡å¼æ§åˆ¶**: æ”¯æ´è‡ªå‹• (Auto)ã€æ‰‹å‹• (Manual)ã€æ–æ¡¿ (Joystick) ä¸‰ç¨®æ¨¡å¼åˆ‡æ›ã€‚
*   **å¤šè»¸æ–æ¡¿æ•´åˆ**: æ•´åˆ 3 çµ„é›™è»¸æ–æ¡¿èˆ‡ 1 çµ„å–®è»¸æ–æ¡¿ï¼Œå°æ‡‰æ©Ÿæ¢°æ‰‹è‡‚å„é—œç¯€æ§åˆ¶ã€‚
*   **æ™ºæ…§åƒæ•¸é¸æ“‡**: é€éé›»ä½å™¨èˆ‡åˆ‡æ›é–‹é—œï¼Œå¯å‹•æ…‹é¸æ“‡ã€Œè©¦é«”ã€æˆ–ã€Œæ§½ä½åº§æ¨™ (X/Y/Z)ã€ï¼Œä¸¦å‚³é€è‡³ä¸Šä½æ©Ÿã€‚
*   **Web å„€è¡¨æ¿**: å…§å»ºæš—é»‘å·¥æ¥­é¢¨ Web Server (SPIFFS)ï¼Œå¯è¦–åŒ–æ‰€æœ‰é–‹é—œèˆ‡æ–æ¡¿ç‹€æ…‹ã€‚
*   **æ™ºæ…§ç¶²è·¯ç®¡ç†**:
    *   **NVS è¨˜æ†¶**: è‡ªå‹•å„²å­˜ WiFi SSIDã€å¯†ç¢¼èˆ‡å›ºå®š IPã€‚
    *   **æ–·ç·šæ•‘æ´ (AP Mode)**: é€£ç·šå¤±æ•—è‡ªå‹•åˆ‡æ›è‡³ç†±é»æ¨¡å¼ (`ESP32-Controller-Rescue`)ï¼Œæ”¯æ´ç¶²é é…ç¶²ã€‚
*   **OTA æ›´æ–°**: æ”¯æ´é€é Web ä»‹é¢ç„¡ç·šæ›´æ–°éŸŒé«”ã€‚
*   **USBIP æ”¯æ´**: æä¾› Docker å®¹å™¨å…§çš„ USB é€å‚³è§£æ±ºæ–¹æ¡ˆã€‚

## ğŸ›  ç¡¬é«”è¦æ ¼ (Hardware)

*   **MCU**: ESP32-S3-WROOM-1U (N16R8)
    *   **Flash**: 16MB
    *   **PSRAM**: 8MB (Octal Mode)
*   **ä¸Šä½æ©Ÿ**: NVIDIA Jetson Orin Nano (é€é UART é€šè¨Š)ã€‚
*   **é›»æº**: å¤–éƒ¨ä¾›é›» (æ³¨æ„ï¼šéƒ¨åˆ†æŒ‡ç¤ºç‡ˆèˆ‡èœ‚é³´å™¨ç‚º 220V ç³»çµ±ï¼Œéœ€é€éç¹¼é›»å™¨éš”é›¢æ§åˆ¶)ã€‚

---

## ğŸ”Œ è…³ä½å®šç¾©èˆ‡å…ƒä»¶è¡¨ (Pin Map)

æœ¬ç³»çµ±é€£æ¥äº†å¤§é‡çš„è¼¸å…¥è¼¸å‡ºå…ƒä»¶ï¼Œä»¥ä¸‹å®šç¾©åŸºæ–¼ `main/io_config.h` é…ç½®ã€‚
**æ³¨æ„ï¼š** ESP32-S3 éƒ¨åˆ†è…³ä½æœ‰ç‰¹æ®Šé™åˆ¶ (å¦‚ ADC1/2, Strap Pin)ï¼Œè«‹å‹™å¿…ä¾ç…§ä¸‹è¡¨æ¥ç·šã€‚

### 1. ç³»çµ±èˆ‡é›»æºç«¯ (Power & System)
| å…ƒä»¶ç·¨è™Ÿ | å…ƒä»¶åç¨± | è¼¸å…¥/è¼¸å‡º | æ•¸é‡ | GPIO | åŠŸèƒ½æè¿° | å‚™è¨» |
| :---: | :--- | :---: | :---: | :---: | :--- | :--- |
| **Z1** | OTA æ›´æ–°æŒ‰éˆ• | è¼¸å…¥ | 1 | **0** | è§¸ç™¼éŸŒé«”æ›´æ–° (ä½¿ç”¨æ¿è¼‰ BOOT éµ) | æ¸¬è©¦ç”¨ï¼Œäº¦å¯å¤–æ¥ |
| **A1** | ä¸‰æª”ä½é–‹é—œ | è¼¸å…¥ | 2 | **4, 5** | åˆ‡æ›æ“ä½œæ¨¡å¼ (å·¦:è‡ªå‹• / ä¸­:æ‰‹å‹• / å³:æ–æ¡¿) | 4=A1_1, 5=A1_2 |
| **A2** | ç‹€æ…‹æŒ‡ç¤ºç‡ˆ (é»ƒ) | è¼¸å‡º | 1 | **6** | **è‡ªå‹•æ¨¡å¼** æŒ‡ç¤ºç‡ˆ | 220V (éœ€ç¹¼é›»å™¨) |
| **A3** | ç‹€æ…‹æŒ‡ç¤ºç‡ˆ (è—) | è¼¸å‡º | 1 | **7** | **æ‰‹å‹•æ¨¡å¼** æŒ‡ç¤ºç‡ˆ | 220V (éœ€ç¹¼é›»å™¨) |
| **A4** | ç‹€æ…‹æŒ‡ç¤ºç‡ˆ (ç¶ ) | è¼¸å‡º | 1 | **15** | **æ–æ¡¿æ¨¡å¼** æŒ‡ç¤ºç‡ˆ | 220V (éœ€ç¹¼é›»å™¨) |

### 2. åƒæ•¸é¸æ“‡ç«¯ (Selection)
| å…ƒä»¶ç·¨è™Ÿ | å…ƒä»¶åç¨± | è¼¸å…¥/è¼¸å‡º | æ•¸é‡ | GPIO | åŠŸèƒ½æè¿° | å‚™è¨» |
| :---: | :--- | :---: | :---: | :---: | :--- | :--- |
| **B1** | ä¸‰æª”ä½é–‹é—œ | è¼¸å…¥ | 2 | **16, 17** | é¸æ“‡åº§æ¨™è»¸ (å·¦:ç¸± / ä¸­:æ©« / å³:é«˜) | 16=B1_1, 17=B1_2 |
| **B2** | é›»ä½å™¨ (Pot) | è¼¸å…¥ (ADC) | 1 | **1** | é¸æ“‡ **è©¦é«” (Item)** ç·¨è™Ÿ | **ADC1_CH0** |
| **B3** | é›»ä½å™¨ (Pot) | è¼¸å…¥ (ADC) | 1 | **2** | é¸æ“‡ **æ§½ä½ (Slot)** æ•¸å€¼ | **ADC1_CH1** |
| **B4** | åˆ‡æ›é–‹é—œ | è¼¸å…¥ | 1 | **8** | åˆ‡æ›è®€å–æºï¼šOFF è®€ B2ï¼ŒON è®€ B3 | å·¦å´è…³ä½ |
| **B5** | é»å‹•é–‹é—œ | è¼¸å…¥ | 1 | **9** | **ç¢ºèªéµ**ï¼ŒæŒ‰ä¸‹å‚³é€æ•¸æ“š | å·¦å´è…³ä½ |
| **B6** | èœ‚é³´å™¨ | è¼¸å‡º | 1 | **10** | æ“ä½œæç¤ºéŸ³æˆ–è­¦å ± | 220V (éœ€ç¹¼é›»å™¨) |

> **âš ï¸ æ³¨æ„**ï¼šB2 èˆ‡ B3 å¿…é ˆä½¿ç”¨ **GPIO 1 & 2** (ADC1 é€šé“)ï¼Œè‹¥ä½¿ç”¨ ADC2 æœƒå°è‡´ WiFi é€£ç·šæ™‚ç„¡æ³•è®€å–æ•¸å€¼ã€‚

### 3. æ–æ¡¿æ§åˆ¶ç«¯ (Joystick)
| å…ƒä»¶ç·¨è™Ÿ | å…ƒä»¶åç¨± | I/O | GPIO (4è·¯/2è·¯) | åŠŸèƒ½æè¿° | å‚™è¨» |
| :---: | :--- | :---: | :--- | :--- | :--- |
| **C1** | é›™è»¸æ–æ¡¿ | è¼¸å…¥ | **11, 12, 13, 14** | X / Y è»¸ç§»å‹• | å·¦å´ä¸‹åŠéƒ¨ |
| **C2** | é›™è»¸æ–æ¡¿ | è¼¸å…¥ | **38, 39, 40, 41** | å¤§å°æ‰‹è‡‚æ§åˆ¶ | å³å´ä¸­æ®µ |
| **C3** | é›™è»¸æ–æ¡¿ | è¼¸å…¥ | **42, 21, 3, 18** | è‚©è†€ / æ‰‹è…•æ—‹è½‰ | **GPIO 3** éœ€ç¢ºèªç„¡ PSRAM è¡çª |
| **C4** | å–®è»¸æ–æ¡¿ | è¼¸å…¥ | **48, 45** | æ‰‹æŒå¤¾å– | **GPIO 45** é–‹æ©Ÿæ™‚ä¸å¯æ‹‰ä½ |

> **âš ï¸ ç‰¹åˆ¥æ³¨æ„**ï¼š
> *   **GPIO 45 (C4_2)**: ç‚º Strap Pinï¼Œé–‹æ©Ÿç¬é–“å¿…é ˆä¿æŒé«˜é›»ä½ï¼Œè«‹ç¢ºä¿æ–æ¡¿æœªè¢«æ‹‰ä½ã€‚
> *   **GPIO 3 (C3_3)**: è‹¥ä½¿ç”¨ Octal PSRAM æ¨¡çµ„ï¼Œæ­¤è…³ä½å¶çˆ¾æœƒè¢«ä½”ç”¨ï¼Œè‹¥è®€å–ç•°å¸¸è«‹æ›´æ›è…³ä½ã€‚

### 4. é€šè¨Šä»‹é¢ (UART)
| è£ç½® | TX Pin | RX Pin | Baud Rate | èªªæ˜ |
| :--- | :---: | :---: | :---: | :--- |
| **Jetson Orin Nano** | **46** | **47** | 115200 | JSON æ ¼å¼è³‡æ–™å‚³è¼¸ |

---

## âš¡ æ§åˆ¶é‚è¼¯èªªæ˜ (Logic)

### 1. é›»æºæ¨¡å¼é‚è¼¯ (Power Mode)
ç³»çµ±æ ¹æ“š **A1 ä¸‰æª”ä½é–‹é—œ** (A1_1, A1_2) çš„ç‹€æ…‹æ±ºå®šè¼¸å‡ºç‡ˆè™Ÿï¼š
*   **æ‰‹å‹•æ¨¡å¼ (è—ç‡ˆ A3)**: ç•¶ `A1_1` ç‚º Highã€‚
*   **æ–æ¡¿æ¨¡å¼ (ç¶ ç‡ˆ A4)**: ç•¶ `A1_2` ç‚º Highã€‚
*   **è‡ªå‹•æ¨¡å¼ (é»ƒç‡ˆ A2)**: ç•¶ `A1_1` èˆ‡ `A1_2` åŒæ™‚ç‚º High (ç¡¬é«”æ¥ç·šé‚è¼¯)ã€‚
*   *å‚™è¨»ï¼šè»Ÿé«”å…§éƒ¨ä½¿ç”¨ä¸Šæ‹‰é›»é˜» (Pull-up)ï¼Œå¯¦éš›è§¸ç™¼é‚è¼¯è¦–ç¡¬é«”æ¥ç·šè€Œå®š (é€šå¸¸é–‹é—œå°é€šæ¥åœ°ç‚º Lowï¼Œç¨‹å¼éœ€åç›¸åˆ¤æ–·)ã€‚*

### 2. åƒæ•¸é¸æ“‡é‚è¼¯ (Selection Mode)
ç•¶ç³»çµ±è™•æ–¼ **æ‰‹å‹•æ¨¡å¼ (A3 ON)** æ™‚ï¼Œé¸æ“‡ç«¯åŠŸèƒ½å•Ÿç”¨ï¼š
*   **è®Šæ•¸åˆ‡æ›**: é€é **B4 é–‹é—œ** æ±ºå®šè®€å– **B2 (è©¦é«”)** é‚„æ˜¯ **B3 (æ§½ä½)** çš„é›»ä½å™¨æ•¸å€¼ã€‚
*   **ç›®æ¨™é–å®š**: è‹¥è®€å– B3ï¼Œé€é **B1 ä¸‰æª”ä½é–‹é—œ** æ±ºå®šè©²æ•¸å€¼æ˜¯å¯«å…¥ã€Œç¸±è»¸ã€ã€ã€Œæ©«è»¸ã€é‚„æ˜¯ã€Œé«˜åº¦ã€ã€‚
*   **è³‡æ–™å‚³é€**: æŒ‰ä¸‹ **B5 é»å‹•é–‹é—œ**ï¼Œå°‡ç›®å‰çš„è®Šæ•¸èˆ‡æ•¸å€¼æ‰“åŒ…æˆ JSONï¼Œé€é UART ç™¼é€çµ¦ Jetsonï¼Œä¸¦è§¸ç™¼ **B6 èœ‚é³´å™¨** çŸ­éŸ¿æç¤ºã€‚

---

## ğŸŒ ç¶²è·¯é…ç½®èˆ‡æ•‘æ´æ¨¡å¼ (Network & Rescue)

æœ¬ç³»çµ±å…·å‚™æ™ºæ…§é…ç¶²åŠŸèƒ½ï¼Œç„¡éœ€æ¯æ¬¡ä¿®æ”¹ç¨‹å¼ç¢¼ã€‚

### 1. æ­£å¸¸å•Ÿå‹•
*   ç³»çµ±æœƒè®€å– NVS çš„ WiFi è¨­å®šã€‚
*   é è¨­å‡ºå» è¨­å®šï¼š
    *   SSID: `SSID`
    *   å¯†ç¢¼: `********`
    *   Static IP: `192.168.2.123`

### 2. æ•‘æ´æ¨¡å¼ (AP Mode)
è‹¥é€£ç·šå¤±æ•— (è¶…é 5 æ¬¡é‡è©¦)ï¼Œè‡ªå‹•åˆ‡æ›ç‚º **ç†±é»æ¨¡å¼**ï¼š
1.  **æœå°‹ WiFi**: `ESP32-Controller-Rescue`
2.  **ç€è¦½å™¨è¨ªå•**: `http://192.168.4.1`
3.  åœ¨å„€è¡¨æ¿çš„ã€Œç¶²è·¯è¨­å®šã€å€å¡Šè¼¸å…¥æ­£ç¢ºè³‡è¨Šä¸¦å„²å­˜ã€‚

---

## ğŸš€ é–‹ç™¼èˆ‡ç’°å¢ƒè¨­å®š (Development)

### 1. ESP-IDF ç·¨è­¯èˆ‡ç‡’éŒ„
æœ¬å°ˆæ¡ˆä½¿ç”¨ SPIFFS å­˜æ”¾ç¶²é ï¼Œè«‹ç¢ºä¿æ ¹ç›®éŒ„æœ‰ `spiffs_image` è³‡æ–™å¤¾ã€‚

```bash
# è¨­å®šç›®æ¨™æ™¶ç‰‡
idf.py set-target esp32s3

# Menuconfig è¨­å®š (é—œéµ!)
idf.py menuconfig
# -> Serial Flasher Config -> Flash Size: 16MB
# -> Partition Table -> Custom partition table CSV
# -> Component config -> ESP32S3-Specific -> PSRAM: Octal Mode

# ç·¨è­¯èˆ‡ç‡’éŒ„
idf.py build flash monitor
```

### 2. Docker èˆ‡ USBIP è¨­å®š (Windows/WSL)
ç”±æ–¼ Docker Desktop (Windows) ç„¡æ³•ç›´æ¥å­˜å– USB è¨­å‚™ï¼Œè‹¥ä½¿ç”¨ Dev Container é–‹ç™¼ï¼Œéœ€é€é usbipd-win é€²è¡Œé€å‚³ã€‚
### æ­¥é©Ÿ A: Windows ä¸»æ©Ÿç«¯
#### 1.å®‰è£ usbipd-winã€‚
#### 2.ç®¡ç†å“¡èº«åˆ†é–‹å•Ÿ PowerShellï¼Œåˆ—å‡ºè£ç½®ï¼š
```powershell
usbipd list
```
#### 3.ç¶å®š ESP32 è£ç½® (å‡è¨­ BusID ç‚º	`1-3`):
```powershell
usbipd bind --busid 1-3
```

#### 4.å°‡è£ç½®é€å‚³çµ¦ WSLï¼š
```
usbipd wsl attach --busid <BUSID> --auto-attach
```

### æ­¥é©Ÿ B: WSL ç«¯
#### 1.å®‰è£ usbip å·¥å…·ï¼š
```bash
sudo apt install linux-tools-virtual hwdata
sudo update-alternatives --install /usr/bin/usbip usbip `ls /usr/lib/linux-tools/*/usbip | tail -n1` 20
```
#### 2.é©—è­‰æ˜¯å¦æŠ“åˆ°è£ç½®ï¼š
```bash
lsusb
```
è‹¥çœ‹åˆ° Espressif è£ç½®ï¼Œå³ä»£è¡¨é€å‚³æˆåŠŸï¼Œå¯åœ¨ Docker å…§é€²è¡Œç‡’éŒ„ã€‚
